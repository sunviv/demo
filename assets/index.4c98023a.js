var oe=Object.defineProperty,ne=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var A=(o,t,r)=>t in o?oe(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,d=(o,t)=>{for(var r in t||(t={}))ie.call(t,r)&&A(o,r,t[r]);if(N)for(var r of N(t))re.call(t,r)&&A(o,r,t[r]);return o},m=(o,t)=>ne(o,se(t));import{N as ae,a as ce,b as le,o as ue,c as de,S as fe,C as R,P as pe,O as me,A as ge,d as he,D as we,W as Pe,G as ye,r as be,e as M,R as ve,V as z,E as Ce,f as _e,g as ke,t as Le,h as _,i as k,j as Fe,w as je,v as xe,k as B,l as L,m as E,n as D,p as Oe,F as Se,q as W,s as T,u as V,x as Ne}from"./vendor.757f08c1.js";const Ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function r(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=r(a);fetch(a.href,l)}};Ae();var Re=(o,t)=>{for(const[r,s]of t)o[r]=s;return o};const Me={name:"CapStructure",components:{NProgress:ae,NButton:ce,NColorPicker:le},setup(){let o,t,r,s,a,l,f,u;ue(()=>{b()}),de(()=>{document.removeEventListener("click",S)});async function b(){q(),H(),I(),K(),U(),G(),f=await X(),ee(),te(),requestAnimationFrame(F)}function q(){s=document.querySelector("#structure")}function H(){o=new fe,o.background=new R(15067115)}function I(){const e=45,n=2,i=1,c=100;t=new pe(e,n,i,c),t.position.set(8,8,8),t.lookAt(0,0,0)}function G(){a=new me(t,s),a.target.set(0,0,0),a.update()}function K(){const e=new ge(16777215,.8);o.add(e);const n=new he(8947848,.5);n.position.set(0,0,100),o.add(n);const i=new we(8947848,1);i.position.set(0,10,0),i.target.position.set(0,0,0),o.add(i),o.add(i.target)}function U(){r=new Pe({canvas:s,antialias:!0}),r.setPixelRatio(window.devicePixelRatio)}async function X(){u=await J("/demo/assets/models/cap.glb"),u.scene.position.set(0,0,0),u.scene.scale.set(.07,.07,.07),u.scene.rotation.set(-.7,0,.1);const e=u.scene.getObjectByName("cap-o"),n=u.scene.getObjectByName("cap-i-t"),i=u.scene.getObjectByName("cap-i-m"),c=u.scene.getObjectByName("cap-i-b");return e.fromPosition=d({},e.position),e.toPosition=m(d({},e.fromPosition),{y:e.fromPosition.y+60}),n.fromPosition=d({},n.position),n.toPosition=m(d({},n.fromPosition),{y:n.fromPosition.y-3.75}),i.fromPosition=d({},i.position),i.toPosition=m(d({},i.fromPosition),{y:i.fromPosition.y-30}),c.fromPosition=d({},c.position),c.toPosition=m(d({},c.fromPosition),{y:c.fromPosition.y-60}),o.add(u.scene),{capOuter:e,capInnerTop:n,capInnerMiddle:i,capInnerBottom:c}}function F(e){Y(r)&&(t.aspect=s.clientWidth/s.clientHeight,t.updateProjectionMatrix()),g.render(),requestAnimationFrame(F)}function Y(e){const n=s.clientWidth,i=s.clientHeight,c=s.width!=n||s.height!=i;return c&&(e.setSize(n,i,!1),g.setSize(n,i,!1)),c}let h=be({isLoading:!1,percentage:0});function J(e){return new Promise((n,i)=>{h.isLoading=!0,l||(l=new ye),l.load(e,c=>{n(c),setTimeout(()=>{h.isLoading=!1},300)},({loaded:c,total:P})=>{console.log(c,P),h.percentage=parseInt(c/P*100),console.log(h.percentage)})})}let y=M(!1);function Q(){y.value=!y.value,y.value?x(u.scene,.05,{ease:"Power4.in",duration:.3}).then(()=>Object.values(f).forEach(e=>j(e,e.fromPosition,e.toPosition,{duration:.6,delay:Math.random()*.2,ease:"Power4.out"}))):Promise.all(Object.values(f).map(e=>j(e,e.toPosition,e.fromPosition,{duration:.8,delay:Math.random()*.2,ease:"back.in(6)"}))).then(()=>x(u.scene,.07,{ease:"Power4.out",duration:.3}))}function j(e,n,i,c){return new Promise((P,Te)=>{W.to(e.position,m(d(d({},i),c),{onComplete(){P()}}))})}function x(e,n,i){return new Promise((c,P)=>{W.to(e.scale,m(d({x:n,y:n,z:n},i),{onComplete(){c()}}))})}let v=M(!1);function Z(){v.value=!v.value}function $(e){if(console.log("complete:",e),w){let n=w.material.clone();n.color=new R(e),w.material=n}}function ee(){document.body.addEventListener("click",S)}let O=new ve,C=new z,w=null;function S(e){if(e.target!=s)return;C.x=e.clientX/s.clientWidth*2-1,C.y=-(e.clientY/s.clientHeight)*2+1,O.setFromCamera(C,t);let n=O.intersectObjects(u.scene.children,!0);n.length>0&&(w=n[0].object,p.selectedObjects=[w])}let g,p;function te(){g=new Ce(r),g.setPixelRatio(window.devicePixelRatio);let e=new _e(o,t);g.addPass(e),p=new ke(new z(s.clientWidth,s.clientHeight),o,t),p.visibleEdgeColor.set("#10b981"),p.edgeStrength=4,p.edgeGlow=1.2,p.edgeThickness=2,g.addPass(p)}return d({hasDisassembled:y,toggleAssemble:Q,toggleColor:Z,showColorPicker:v,onColorPickerComplete:$},Le(h))}},ze={id:"structure",class:"block w-full h-full"},Be={class:"absolute right-0 z-10 flex flex-col items-center justify-center px-4 py-1 overflow-hidden transform -translate-y-1/2 top-1/2"};function Ee(o,t,r,s,a,l){const f=_("n-button"),u=_("n-color-picker"),b=_("n-progress");return k(),Fe(Se,null,[je(B("canvas",ze,null,512),[[xe,!o.isLoading]]),B("div",Be,[L(f,{onClick:s.toggleAssemble,circle:"",size:"large",color:"#3b82f6",class:"focus:outline-none"},{default:E(()=>[T(V(s.hasDisassembled?"\u8FD8\u539F":"\u5206\u89E3"),1)]),_:1},8,["onClick"]),L(f,{onClick:s.toggleColor,circle:"",size:"large",color:"#3b82f6",class:"mt-4 focus:outline-none"},{default:E(()=>[T(V(s.showColorPicker?"\u5173\u95ED":"\u6362\u80A4")+" ",1),L(u,{show:s.showColorPicker,"show-preview":!1,"default-show":!1,"show-alpha":!1,swatches:["#FFFFFF","#18A058","#2080F0","#F0A020","rgb(208, 48, 80)"],class:"absolute opacity-0 pointer-events-none","on-complete":s.onColorPickerComplete},null,8,["show","swatches","on-complete"])]),_:1},8,["onClick"])]),o.isLoading?(k(),D(b,{key:0,type:"circle",percentage:o.percentage,class:"absolute z-10 transform -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"},null,8,["percentage"])):Oe("",!0)],64)}var De=Re(Me,[["render",Ee]]);const We={setup(o){return(t,r)=>(k(),D(De))}};Ne(We).mount("#app");
